/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/6.7/samples
 */
apply from: 'build-anyfail.gradle'

def random = new Random();

task mayFail1 {
    doLast {
        if (random.nextBoolean()) {
            throw new GradleException("Failing ${it.name}")
        }
    }
}

task mayFail2 {
    doLast {
        if (random.nextBoolean()) {
            throw new GradleException("Failing ${it.name}")
        }
    }
}

project.ext.__allowFail = ['mayFail1', 'mayFail2']

task mayFail {
    dependsOn mayFail1,mayFail2
    doLast {
        if (project.ext.__anyFailed) {
            project.ext.__failures.each { failure ->
                println failure
            }
            throw new GradleException("Failing ${it.name}")
        }
    }
}


